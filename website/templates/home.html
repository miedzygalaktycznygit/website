{% extends "base.html" %}

{% block title %} Home Page {% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center">Search for Products</h1>
    
    <!-- Search Bar -->
    <div class="input-group mb-3">
        <input type="text" id="search-input" class="form-control" placeholder="Search for products..." onkeyup="showSuggestions()" onclick="showSuggestions()">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" onclick="addProduct()">Add Product</button>
        </div>
    </div>

    <!-- Suggestions List -->
    <ul id="suggestions-list" class="list-group"></ul>

    <!-- Product List -->
    <h3>Selected Products:</h3>
    <ul id="product-list" class="list-group">
        <!-- Lista dodanych produktów -->
    </ul>
</div>

<script>
    let selectedProducts = [];

    function showSuggestions() {
        const query = document.getElementById('search-input').value;

        fetch(`/search?q=${query}`)
            .then(response => response.json())
            .then(data => {
                const suggestionsList = document.getElementById('suggestions-list');
                suggestionsList.innerHTML = ''; // Wyczyść listę sugestii

                // Pokaż maksymalnie 5 najlepszych dopasowań
                const maxSuggestions = 5;
                const limitedData = data.slice(0, maxSuggestions);

                limitedData.forEach(product => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item';
                    li.innerHTML = `${product.name} - Price: $${product.price}, Calories: ${product.calories}, Protein: ${product.protein}g`;
                    li.onclick = () => selectProduct(product);
                    suggestionsList.appendChild(li);
                });
            });
    }

    function selectProduct(product) {
        // Sprawdzenie, czy produkt nie został już dodany
        if (!selectedProducts.some(p => p.name === product.name)) {
            selectedProducts.push(product);
            updateProductList();
        }
        document.getElementById('search-input').value = '';  // Wyczyść pole wyszukiwania
        document.getElementById('suggestions-list').innerHTML = '';  // Wyczyść sugestie
    }

    function updateProductList() {
        const productList = document.getElementById('product-list');
        productList.innerHTML = ''; // Wyczyść bieżącą listę

        selectedProducts.forEach((product, index) => {
            const li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.innerHTML = `${product.name} - Price: $${product.price}, Calories: ${product.calories}, Protein: ${product.protein}g`;

            // Dodanie przycisku "Usuń"
            const removeButton = document.createElement('button');
            removeButton.className = 'btn btn-danger btn-sm';
            removeButton.textContent = 'Usuń';
            removeButton.onclick = () => removeProduct(index);
            li.appendChild(removeButton);

            productList.appendChild(li);
        });
    }

    function removeProduct(index) {
        selectedProducts.splice(index, 1); // Usuń produkt z listy
        updateProductList(); // Zaktualizuj widok listy
    }

    // Ukryj sugestie, gdy użytkownik kliknie poza polem wyszukiwania
    document.addEventListener('click', function(event) {
        const searchInput = document.getElementById('search-input');
        const suggestionsList = document.getElementById('suggestions-list');
        if (!searchInput.contains(event.target) && !suggestionsList.contains(event.target)) {
            suggestionsList.innerHTML = '';  // Ukryj sugestie
        }
    });
</script>

{% endblock %}
